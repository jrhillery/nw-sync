<!--
build file for ant
http://jakarta.apache.org/ant/index.html
-->

<project name="nwsync" default="all" basedir=".">
  <property name="version"  value="1.0"/>
  <property name="src" value=".."/>
  <property name="build" value="."/>
  <property name="moneydance.devkit" value="C:/Users/John/Documents/Prog/moneydance-devkit-4.0"/>
  <property name="thirdparty" value="${src}/../3rdParty"/>
  <property name="odfdom.toolkit" value="${thirdparty}/odftoolkit-0.6.2-incubating"/>
  <property name="privkeyfile" value="${build}/priv_key"/>
  <property name="pubkeyfile" value="${build}/pub_key"/>
  <property name="privkeyid" value="99"/>

  <property name="build.compiler.fulldepend"  value="true"/>
  <property name="build.sysclasspath" value="ignore" /> <!-- suppress ridiculous "includeantruntime not set" messages from ant -->
  <property name="build.includeantruntime" value="false"/>
  <property name="dist"  value="${src}/dist"/>
  <property name="debug"  value="on"/>
  <property name="optimize"  value="off"/>

  <path id="classpath">
    <pathelement path="${moneydance.devkit}/lib/extadmin.jar"/>
    <pathelement path="${moneydance.devkit}/lib/moneydance-dev.jar"/>
    <pathelement path="${odfdom.toolkit}/odfdom-java-0.8.11-incubating.jar"/>
    <pathelement path="${odfdom.toolkit}/simple-odf-0.8.2-incubating.jar"/>
    <pathelement path="${thirdparty}/xercesImpl-2.9.1.jar"/>
  </path>

  <target name="init">
    <mkdir dir="${dist}"/>
  </target>

  <target name="nwsync" depends="init">
    <javac target="1.6" source="1.6" srcdir="${src}/src/main/java" debug="${debug}" optimize="${optimize}"
      classpathref="classpath"  destdir="${build}"
      includes="com/moneydance/modules/features/nwsync/**"/>

    <jar destfile="${build}/nwsync.mxt">
      <fileset dir="${src}/src/main/resources" includes="**"/>
      <fileset dir="${build}" includes="com/moneydance/modules/features/nwsync/**"/>
      <zipgroupfileset dir="${odfdom.toolkit}" includes="
        simple-odf-0.8.2-incubating.jar
        odfdom-java-0.8.11-incubating.jar"/>
      <zipgroupfileset dir="${thirdparty}" includes="
        xercesImpl-2.9.1.jar
        java-rdfa-0.4.2.jar
        jena-core-2.11.2.jar
        jena-iri-1.0.2.jar
        commons-validator-1.5.0.jar"/>
    </jar>

    <java newenvironment="true" 
      inputstring="nwsync's passphrase"
      classpathref="classpath"
      classname="com.moneydance.admin.KeyAdmin">
      <arg value="signextjar"/>
      <arg value="${privkeyfile}"/>
      <arg value="${privkeyid}"/>
      <arg value="nwsync"/>
      <arg line="${build}/nwsync.mxt"/>
    </java>
    <move file="s-nwsync.mxt" tofile="${dist}/nwsync.mxt"/>
  </target>

  <target name="genkeys" depends="init">
    <java 
      inputstring="nwsync's passphrase"
      classpathref="classpath"
      classname="com.moneydance.admin.KeyAdmin">
      <arg value="genkey"/>
      <arg value="${privkeyfile}"/>
      <arg value="${pubkeyfile}"/>
    </java>
  </target>

  <target name="all" depends="nwsync"/>

</project>
